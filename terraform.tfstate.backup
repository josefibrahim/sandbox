{
  "version": 4,
  "terraform_version": "0.12.6",
  "serial": 86,
  "lineage": "9d72d61c-430b-8891-177a-857683e9b0d3",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "google_compute_firewall",
      "name": "lb",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "allow": [
              {
                "ports": [
                  "443"
                ],
                "protocol": "tcp"
              }
            ],
            "creation_timestamp": "2021-06-28T03:31:14.592-07:00",
            "deny": [],
            "description": "",
            "destination_ranges": [],
            "direction": "INGRESS",
            "disabled": false,
            "enable_logging": false,
            "id": "projects/coen-josef-ibrahim/global/firewalls/sandbox-lb",
            "name": "sandbox-lb",
            "network": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/networks/sandbox-network",
            "priority": 1000,
            "project": "coen-josef-ibrahim",
            "self_link": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/firewalls/sandbox-lb",
            "source_ranges": [
              "130.211.0.0/22",
              "35.191.0.0/16"
            ],
            "source_service_accounts": [],
            "source_tags": [],
            "target_service_accounts": [],
            "target_tags": [
              "lb"
            ],
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwLCJ1cGRhdGUiOjI0MDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "depends_on": [
            "google_compute_network.vpc_network"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_firewall",
      "name": "ssh",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "allow": [
              {
                "ports": [
                  "22"
                ],
                "protocol": "tcp"
              }
            ],
            "creation_timestamp": "2021-06-28T03:31:14.694-07:00",
            "deny": [],
            "description": "",
            "destination_ranges": [],
            "direction": "INGRESS",
            "disabled": false,
            "enable_logging": false,
            "id": "projects/coen-josef-ibrahim/global/firewalls/sandbox-ssh",
            "name": "sandbox-ssh",
            "network": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/networks/sandbox-network",
            "priority": 1000,
            "project": "coen-josef-ibrahim",
            "self_link": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/firewalls/sandbox-ssh",
            "source_ranges": [
              "0.0.0.0/0"
            ],
            "source_service_accounts": [],
            "source_tags": [],
            "target_service_accounts": [],
            "target_tags": [
              "ssh"
            ],
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwLCJ1cGRhdGUiOjI0MDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "depends_on": [
            "google_compute_network.vpc_network"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "vm",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": true,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20210623",
                    "labels": {},
                    "size": 10,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/zones/europe-west3-a/disks/sandbox-vm"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Broadwell",
            "deletion_protection": false,
            "description": "",
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/coen-josef-ibrahim/zones/europe-west3-a/instances/sandbox-vm",
            "instance_id": "6665774566389062172",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": {},
            "machine_type": "f1-micro",
            "metadata": {},
            "metadata_fingerprint": "kOkrOUaq120=",
            "metadata_startup_script": "#!/bin/bash\n\n#update\nsudo apt-get update\n\n#isntall nginx, mysql and php\nsudo apt-get install nginx mysql-server php-fpm php-mysql -y\n\n#config php\nsudo mkdir /var/www/wordpress\nsudo chown -R $USER:$USER /var/www/your_domain\n\n# ssl\n## Create the SSL Certificate\nsudo openssl req -x509 -nodes -subj \"/CN=Sandbox/\" -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt\nsudo openssl dhparam -out /etc/nginx/dhparam.pem 2048\n\n## Create a Configuration Snippet\ntouch self-signed.config\ncat\u003c\u003cEOT \u003e\u003e self-signed.conf\nssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;\nssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;\nEOT\nsudo mv self-signed.conf /etc/nginx/snippets/\n\n## create configuration Snippet with strong encryption settings\ntouch ssl-params.conf\ncat\u003c\u003cEOT \u003e\u003e ssl-params.conf\nssl_protocols TLSv1.2;\nssl_prefer_server_ciphers on;\nssl_dhparam /etc/nginx/dhparam.pem;\nssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;\nssl_ecdh_curve secp384r1; # Requires nginx \u003e= 1.1.0\nssl_session_timeout  10m;\nssl_session_cache shared:SSL:10m;\nssl_session_tickets off; # Requires nginx \u003e= 1.5.9\nssl_stapling on; # Requires nginx \u003e= 1.3.7\nssl_stapling_verify on; # Requires nginx =\u003e 1.3.7\nresolver 8.8.8.8 8.8.4.4 valid=300s;\nresolver_timeout 5s;\nadd_header X-Frame-Options DENY;\nadd_header X-Content-Type-Options nosniff;\nadd_header X-XSS-Protection \"1; mode=block\";\nEOT\nsudo mv ssl-params.conf /etc/nginx/snippets/\n\n## configuration file\ntouch wordpress\ncat\u003c\u003cEOT \u003e wordpress\nserver {\n    listen 443 ssl;\n    listen [::]:443 ssl;\n    include snippets/self-signed.conf;\n    include snippets/ssl-params.conf;\n\n    server_name wp.josef.rack.gold;\n\n    root /var/www/wordpress/;\n    index index.html index.htm index.nginx-debian.html;\n\n    location /hc {\n        return 200;\n    }\n    location / {\n        try_files $uri /index.php$is_args$args;\n    }\n    location ~ \\.php$ {\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;\n     }\n    location ~ /\\.ht {\n        deny all;\n    }\n    location = /favicon.ico { log_not_found off; access_log off; }\n    location = /robots.txt { log_not_found off; access_log off; allow all; }\n    location ~* \\.(css|gif|ico|jpeg|jpg|js|png)$ {\n        expires max;\n        log_not_found off;\n    }\n}\nEOT\nsudo mv -f wordpress /etc/nginx/sites-available/\nsudo ln -s /etc/nginx/sites-available/wordpress /etc/nginx/sites-enabled/\nsudo unlink /etc/nginx/sites-enabled/default\nsudo systemctl restart nginx\n\n#logging and monitoring agents\ncurl -sSO https://dl.google.com/cloudagents/add-logging-agent-repo.sh\nsudo bash add-logging-agent-repo.sh --also-install\ncurl -sSO https://dl.google.com/cloudagents/add-monitoring-agent-repo.sh\nsudo bash add-monitoring-agent-repo.sh --also-install\n\n#install wordpress\nsudo apt install php-curl php-gd php-intl php-mbstring php-soap php-xml php-xmlrpc php-zip -y\nsudo systemctl restart php7.4-fpm\ncd /tmp\ncurl -LO https://wordpress.org/latest.tar.gz\ntar xzvf latest.tar.gz\ncp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php\nsudo cp -a /tmp/wordpress/. /var/www/wordpress\nsudo chown -R www-data:www-data /var/www/wordpress\n\n\n#wordpress config file\ntouch wp-config.php\ncat\u003c\u003cEOT \u003e wp-config.php\n\u003c?php\ndefine( 'DB_NAME', 'wordpress' );\ndefine( 'DB_USER', 'wordpressuser' );\ndefine( 'DB_PASSWORD', 'password' );\ndefine( 'DB_HOST', 'localhost' );\ndefine( 'DB_CHARSET', 'utf8' );\ndefine( 'DB_COLLATE', '' );\ndefine( 'FS_METHOD', 'direct' );\nEOT\n\ncurl -s https://api.wordpress.org/secret-key/1.1/salt/ \u003e\u003e wp-config.php\n\ncat\u003c\u003cEOT \u003e\u003e wp-config.php\n\\$table_prefix = 'wp_';\ndefine( 'WP_DEBUG', false );\nif ( ! defined( 'ABSPATH' ) ) {\n        define( 'ABSPATH', __DIR__ . '/' );\n}\nrequire_once ABSPATH . 'wp-settings.php';\n?\u003e\nEOT\n\nsudo mv -f wp-config.php /var/www/wordpress\n\nsudo systemctl restart nginx\nsudo systemctl restart php7.4-fpm",
            "min_cpu_platform": "",
            "name": "sandbox-vm",
            "network_interface": [
              {
                "access_config": [],
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/networks/sandbox-network",
                "network_ip": "10.156.0.6",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/regions/europe-west3/subnetworks/sandbox-network",
                "subnetwork_project": "coen-josef-ibrahim"
              }
            ],
            "project": "coen-josef-ibrahim",
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/zones/europe-west3-a/instances/sandbox-vm",
            "service_account": [
              {
                "email": "wordpress@coen-josef-ibrahim.iam.gserviceaccount.com",
                "scopes": [
                  "https://www.googleapis.com/auth/cloud-platform"
                ]
              }
            ],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": [
              "lb",
              "ssh"
            ],
            "tags_fingerprint": "OhLcfqEODCM=",
            "timeouts": null,
            "zone": "europe-west3-a"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9",
          "depends_on": [
            "google_compute_network.vpc_network"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_network",
      "name": "vpc_network",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_subnetworks": true,
            "delete_default_routes_on_create": false,
            "description": "",
            "gateway_ipv4": "",
            "id": "projects/coen-josef-ibrahim/global/networks/sandbox-network",
            "ipv4_range": null,
            "name": "sandbox-network",
            "project": "coen-josef-ibrahim",
            "routing_mode": "REGIONAL",
            "self_link": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/networks/sandbox-network",
            "timeouts": null
          }
        }
      ]
    },
    {
      "module": "module.cloud_router",
      "mode": "managed",
      "type": "google_compute_router",
      "name": "router",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "bgp": [],
            "creation_timestamp": "2021-06-28T03:31:14.936-07:00",
            "description": "",
            "id": "projects/coen-josef-ibrahim/regions/europe-west3/routers/sandbox-router",
            "name": "sandbox-router",
            "network": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/global/networks/sandbox-network",
            "project": "coen-josef-ibrahim",
            "region": "europe-west3",
            "self_link": "https://www.googleapis.com/compute/v1/projects/coen-josef-ibrahim/regions/europe-west3/routers/sandbox-router",
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwLCJ1cGRhdGUiOjI0MDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "module": "module.cloud_router",
      "mode": "managed",
      "type": "google_compute_router_nat",
      "name": "nats",
      "each": "map",
      "provider": "provider.google",
      "instances": [
        {
          "index_key": "sandbox-gateway",
          "schema_version": 0,
          "attributes": {
            "icmp_idle_timeout_sec": 30,
            "id": "coen-josef-ibrahim/europe-west3/sandbox-router/sandbox-gateway",
            "log_config": [
              {
                "enable": true,
                "filter": "ALL"
              }
            ],
            "min_ports_per_vm": 0,
            "name": "sandbox-gateway",
            "nat_ip_allocate_option": "AUTO_ONLY",
            "nat_ips": [],
            "project": "coen-josef-ibrahim",
            "region": "europe-west3",
            "router": "sandbox-router",
            "source_subnetwork_ip_ranges_to_nat": "ALL_SUBNETWORKS_ALL_IP_RANGES",
            "subnetwork": [],
            "tcp_established_idle_timeout_sec": 1200,
            "tcp_transitory_idle_timeout_sec": 30,
            "timeouts": null,
            "udp_idle_timeout_sec": 30
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "depends_on": [
            "google_compute_router.router"
          ]
        }
      ]
    }
  ]
}
